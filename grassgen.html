<!DOCTYPE html>
<html>
<head>
<style>
canvas {
	border: 3px solid black;
	margin: 32px;
}
</style>
<script>

function Rng(a) {
	// source: https://stackoverflow.com/a/47593316
	return function() {
		var t = a += 0x6D2B79F5;
		t = Math.imul(t ^ t >>> 15, t | 1);
		t ^= t + Math.imul(t ^ t >>> 7, t | 61);
		return ((t ^ t >>> 14) >>> 0) / 4294967296;
	}
}

class Range{
	constructor(min, max) {
		if (max >= min){
			this.min = min;
			this.max = max;
		} else {
			this.min = max;
			this.max = min;
		}
	}

	sample(t) {
		return t * (this.max - this.min) + this.min;
	}
}

function lerp(a, b, t) {
	let c = {};
	for (let prop in a) {
		c[prop] = a[prop] * (1 - t) + b[prop] * t;
	}
	return c;
}

function quadBezier(p0, p1, p2, t) {
	let q0 = lerp(p0, p1, t);
	let q1 = lerp(p1, p2, t);
	return lerp(q0, q1, t);
}

class Color {
	constructor(r, g, b) {
		this.r = r;
		this.g = g;
		this.b = b;
	}

	toString(){
		return `rgb(${Math.round(this.r * 255)}, ${Math.round(this.g * 255)}, ${Math.round(this.b * 255)})`;
	}
}



function control(id) {
	return Number(document.getElementById(id).value);
}

function redraw() {
	let seed = control("seed");
	let width = control("width");
	let height = control("height");
	let nblades = control("nblades");
	let nsegments = control("nsegments");
	let spread = control("spread");
	let colorspread = control("colorspread");
	let bladeWidth = new Range(control("bladewidthmin"), control("bladewidthmax"));

	let random = Rng(seed);
	let canvas = document.getElementById("canvas");
	canvas.width = width;
	canvas.height = height;
	let ctx = canvas.getContext("2d");

	for (let i = 0; i < nblades; ++i){
		let base = {
			x: new Range(0.1, 0.9).sample(random()) * width,
			y: 0,
			w: bladeWidth.sample(random())
		};
		let end = {
			x: new Range(Math.max(base.x - spread, 0), Math.min(base.x + spread, width)).sample(random()),
			y: new Range(height / 2, height).sample(random()),
			w: 0//base.w / 2
		};
		let control = {
			x: new Range(Math.max(base.x - spread, 0), Math.min(base.x + spread, width)).sample(random()),
			y: new Range(end.y / 2, end.y).sample(random()),
			w: new Range(base.w/2, base.w).sample(random())
		}
		let color = new Color(random() * colorspread, 1.0 - random() * colorspread, random() * colorspread);
		ctx.fillStyle = color.toString();
		ctx.beginPath();
		ctx.moveTo(base.x - base.w, height - base.y);
		for (let p = 1; p < nsegments * 2 + 1; ++p) {
			let t = Math.min(p, 2 * nsegments - p) / nsegments;
			let b = (p > nsegments) * 2 - 1;
			let pos = quadBezier(base, control, end, t);
			ctx.lineTo(pos.x + pos.w * b, height - pos.y);
		}
		ctx.fill();
	}
}

function main(){
	for (let node of document.getElementsByTagName("input")){
		node.addEventListener("input", redraw);
	}
	redraw();
}

addEventListener("load", main)
</script>
</head>
<body>
<canvas id="canvas"></canvas>
<hr />
<p>
	<label>
		Seed:
		<input type="number" id="seed" value=12></input>
	</label>
</p>
<p>
	<label>
		width:
		<input type="number" id="width" value=512></input>
	</label>
	<label>
		height:
		<input type="number" id="height" value=256></input>
	</label>
	<label>
		Number of grass blades:
		<input type="number" id="nblades" value=200></input>
	</label>
</p>
<p>
	<label>
		Number of blade segments:
		<input type="number" id="nsegments" value=6></input>
	</label>
	<label>
		Maximum horizontal difference
		<input type="number" id="spread" value=80></input>
	</label>
	<div>
		<label>
			Minimum blade width:
			<input type="number" id="bladewidthmin" value=2></input>
		</label>
		<label>
			Maximum blade width:
			<input type="number" id="bladewidthmax" value=8></input>
		</label>
	</div>
	<label>
		Color spread:
		<input type="number" id="colorspread" value=0.3 step=0.1></input>
	</label>
</p>
</body>
</html>
